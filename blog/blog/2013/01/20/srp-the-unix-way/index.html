
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>SRP: The Unix Way - Simple is not easy.</title>
  <meta name="author" content="Chris Geihsler">

  
  <meta name="description" content="Chaining together a set of UNIX&#8217;s small, simple command line utilities gives the operator the ability to solve complex problems in a concise &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://seejee.github.com//blog/2013/01/20/srp-the-unix-way/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="/blog/javascripts/ender.js"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/blog/atom.xml" rel="alternate" title="Simple is not easy." type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Simple is not easy.</a></h1>
  
    <h2>Software will always be hard, but it doesn't have to be this hard.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:seejee.github.com/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">SRP: The Unix Way</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-20T23:17:00-05:00" pubdate data-updated="true">Jan 20<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Chaining together a set of UNIX&#8217;s small, simple command line utilities gives the operator the ability to solve complex problems in a concise way. Many of these tools are over 30 years old, and yet they continue to be used to solve modern problems.</p>

<p>Specifically, this week at work we were focusing on optimizing our Rails application&#8217;s database queries. We were looking for controller actions that made the same database query several times so that we could we eliminate unnecessary database I/O. The application log files contained all the data necessary to find these duplicated queries, we just needed a way to scrape the data and group it in a meaningful way.</p>

<p>We created the following set of commands:</p>

<pre><code>sed '1,/CurrentItemsController#show/d' log/test.log | \
sed '/Completed/,$d' | sed 's/^.*SELECT/SELECT/' | \
sort | uniq -c | sort -r | head -5
</code></pre>

<p>A quick explanation of each command:</p>

<ol>
<li>Read the log file and skip all the lines before the controller action.</li>
</ol>


<pre><code>sed '1,/CurrentItemsController#show/d' log/test.log
</code></pre>

<ol>
<li>Skip all the lines after the controller action.</li>
</ol>


<pre><code>sed '/Completed/,$d' 
</code></pre>

<ol>
<li>Remove all the text on each line that precedes &#8216;SELECT&#8217;.</li>
</ol>


<pre><code>sed 's/^.*SELECT/SELECT/'
</code></pre>

<ol>
<li>Sort the rows so duplicate queries will be on adjacent lines.</li>
</ol>


<pre><code>sort
</code></pre>

<ol>
<li>Group the duplicate lines and count them.</li>
</ol>


<pre><code>uniq -c
</code></pre>

<ol>
<li>Sort the queries by how many times they were duped.</li>
</ol>


<pre><code>sort
</code></pre>

<ol>
<li>Return the top 5.</li>
</ol>


<pre><code>head -5
</code></pre>

<p>And it generated this output:</p>

<pre><code>7 SELECT COUNT(*) FROM "activity_attemptables" WHERE "activity_attemptables"."activity_id" = 1 AND "activity_attemptables"."completed" = 'f'
7 SELECT "activities".* FROM "activities" WHERE "activities"."lesson_id" = 1 AND "activities"."completed" = 'f' ORDER BY activities.position LIMIT 1
4 SELECT "lesson".* FROM "lesson" WHERE "lesson"."id" = 1 AND (lesson.passed IS NULL) ORDER BY lesson.position LIMIT 1
3 SELECT COUNT(*) FROM "activity_attemptables" WHERE "activity_attemptables"."activity_id" = 1 AND "activity_attemptables"."completed" = 'f'
3 SELECT "activities".* FROM "activities" WHERE "activities"."lesson_id" = 1 AND "activities"."completed" = 'f' ORDER BY activities.position LIMIT 1
</code></pre>

<p>Armed with the sorted list of the duplicated queries, we were able to find the sources of the duplication and optimize them.</p>

<p>While I hope you find the concrete example above to be useful, I used the example to make a larger point. Each of the utilities used above has a single responsibility. Because of this, stringing them together to work in ways the original authors never intended was relatively easy.</p>

<p>As we write software, one of the hardest things we have to do is build the right thing for today while making it easy to accommodate the needs of the future. In my experience, this kind of flexibility comes from decomposing objects and functions into small components that have a single responsibility. As requirements change, if a system is decomposed well, then only a few components will need to be added or changed to accommodate the change.</p>

<p>So, before adding new behavior to existing objects, consider this: Did the UNIX designers give grep the ability to count lines? No! They made wc. But, grep <em>was</em> modified to support different kinds of regular expressions.</p>

<p>The UNIX command line toolset is a great example of decomposition into SRP. I hope you will use it not only to solve problems directly, but also to inform your own object design so that your system will achieve some of the same flexibility as UNIX.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Chris Geihsler</span></span>

      








  


<time datetime="2013-01-20T23:17:00-05:00" pubdate data-updated="true">Jan 20<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/blog/categories/srp-/'>SRP,</a>, <a class='category' href='/blog/blog/categories/unix-/'>UNIX,</a>, <a class='category' href='/blog/blog/categories/optimization/'>optimization</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://seejee.github.com//blog/2013/01/20/srp-the-unix-way/" data-via="" data-counturl="http://seejee.github.com//blog/2013/01/20/srp-the-unix-way/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2013/01/20/srp-the-unix-way/">SRP: The Unix Way</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Chris Geihsler -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
